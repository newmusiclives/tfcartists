// This is your Prisma schema file
generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Artist data and status
model Artist {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Basic Info
  name              String
  email             String?  @unique
  phone             String?  @unique
  genre             String?
  bio               String?

  // Discovery Source
  discoverySource   String   // "instagram", "tiktok", "spotify", "manual"
  sourceUrl         String?
  sourceHandle      String?

  // Engagement Metrics
  followerCount     Int?
  engagementRate    Float?
  hasLiveShows      Boolean  @default(false)

  // Status in Riley's Pipeline
  status            ArtistStatus @default(DISCOVERED)
  pipelineStage     String       @default("discovery") // discovery, contacted, engaged, qualified, onboarding, activated

  // Contact Info
  lastContactedAt   DateTime?
  nextFollowUpAt    DateTime?
  conversationCount Int       @default(0)

  // Show Info
  nextShowDate      DateTime?
  nextShowVenue     String?
  nextShowCity      String?
  hasUsedNineWord   Boolean   @default(false)
  firstWinDate      DateTime?

  // Relationships
  conversations     Conversation[]
  shows             Show[]
  donations         Donation[]
  referrals         Referral[]
  artistDiscoveries ArtistDiscovery[]
  scoutCommissions  ScoutCommission[]
  artistDevelopment SponsorArtistDevelopment[]

  // TrueFans RADIO Airplay
  airplayTier       AirplayTier @default(FREE)
  airplayActivatedAt DateTime?
  airplayShares     Int         @default(1) // Shares in the Artist Pool
  lastTierUpgrade   DateTime?

  // Embed & Gamification
  embedListeners    Int      @default(0)  // listeners gained via embed
  xpTotal           Int      @default(0)
  xpLevel           Int      @default(1)

  // Relationships for airplay
  airplayPayments   AirplayPayment[]

  // Soft Delete & Optimistic Locking
  deletedAt         DateTime?    // Soft delete timestamp
  version           Int      @default(1) // Optimistic locking version

  // Metadata
  metadata          Json?

  // Indexes for performance
  @@index([status])
  @@index([pipelineStage])
  @@index([airplayTier])
  @@index([lastContactedAt])
  @@index([nextFollowUpAt])
  @@index([discoverySource])
  @@index([deletedAt])
}

enum ArtistStatus {
  DISCOVERED      // Found by Riley
  CONTACTED       // Riley reached out
  ENGAGED         // Artist responded
  QUALIFIED       // Has live shows, interested
  ONBOARDING      // Setting up profile
  ACTIVATED       // Used the 9-word line
  ACTIVE          // Regular user
  INNER_CIRCLE    // Advocate/referrer
  DORMANT         // Inactive
  UNRESPONSIVE    // No response after attempts
}

enum AirplayTier {
  FREE            // Free tier - 1 share (default for all contacted artists)
  TIER_5          // $5/month - 5 shares
  TIER_20         // $20/month - 25 shares
  TIER_50         // $50/month - 75 shares
  TIER_120        // $120/month - 200 shares
}

// Conversations with Riley
model Conversation {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  artistId    String
  artist      Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  channel     String   // "sms", "instagram", "email"
  messages    Message[]

  // Status
  isActive    Boolean  @default(true)
  handedOffTo String?  // "echo", "nova", "human"

  // Metadata
  metadata    Json?

  // Indexes for performance
  @@index([artistId])
  @@index([isActive])
}

// Individual messages in conversations
model Message {
  id              String       @id @default(cuid())
  createdAt       DateTime     @default(now())

  conversationId  String
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  role            String       // "riley", "artist", "system"
  content         String
  aiProvider      String?      // "openai", "claude"

  // Message metadata
  intent          String?      // "outreach", "qualify", "educate", "book", "motivate"
  wasRead         Boolean      @default(false)
  sentiment       String?      // "positive", "neutral", "negative"

  // Delivery tracking
  deliveryStatus  String?      // "pending", "delivered", "failed", "read"
  externalMessageId String?    // Twilio SID, SendGrid message ID, etc.
  deliveryError   String?      // Error message if delivery failed
  deliveredAt     DateTime?    // When message was successfully delivered

  metadata        Json?

  // Indexes for performance
  @@index([conversationId])
  @@index([createdAt])
}

// Live shows
model Show {
  id          String    @id @default(cuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  artistId    String
  artist      Artist    @relation(fields: [artistId], references: [id], onDelete: Cascade)

  // Show details
  date        DateTime
  venue       String
  city        String
  state       String?

  // Tracking
  status      ShowStatus @default(SCHEDULED)
  usedNineWord Boolean   @default(false)
  donationCount Int      @default(0)
  totalRaised  Float     @default(0)

  // Donations
  donations   Donation[]

  // Metadata
  metadata    Json?
}

enum ShowStatus {
  SCHEDULED
  REMINDED
  LIVE
  COMPLETED
  CANCELLED
}

// Donations/wins
model Donation {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  artistId    String
  artist      Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  showId      String?
  show        Show?    @relation(fields: [showId], references: [id], onDelete: SetNull)

  amount      Float
  fanName     String?
  fanEmail    String?

  // First win tracking
  isFirstWin  Boolean  @default(false)
  celebratedBy String? // "nova"

  metadata    Json?
}

// Referral tracking
model Referral {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())

  referrerId      String
  referrer        Artist   @relation(fields: [referrerId], references: [id], onDelete: Cascade)

  referredEmail   String
  referredName    String?
  status          String   @default("sent") // sent, accepted, activated

  metadata        Json?
}

// Riley's activity log
model RileyActivity {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  action      String   // "discovered_artist", "sent_message", "qualified_artist", "booked_show"
  artistId    String?
  details     Json?

  aiProvider  String?
  successful  Boolean  @default(true)
}

// TrueFans RADIO Airplay Payments
model AirplayPayment {
  id          String      @id @default(cuid())
  createdAt   DateTime    @default(now())

  artistId    String
  artist      Artist      @relation(fields: [artistId], references: [id], onDelete: Cascade)

  tier        AirplayTier
  amount      Float       // $5, $20, $50, or $120
  period      String      // "2024-12", "2025-01", etc.
  status      String      @default("active") // active, expired, cancelled

  // Payment metadata
  paymentMethod String?
  transactionId String?

  metadata    Json?

  // Indexes for performance
  @@index([artistId])
  @@index([period])
  @@index([status])
}

// TrueFans RADIO Revenue Pool (monthly)
model RadioRevenuePool {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())

  period          String   @unique // "2024-12", "2025-01", etc.

  // Revenue tracking
  totalAdRevenue  Float    @default(0)
  artistPoolAmount Float   @default(0) // 80% of totalAdRevenue
  totalShares     Int      @default(0) // Sum of all artist shares
  perShareValue   Float    @default(0) // artistPoolAmount / totalShares

  // Artist counts by tier
  freeArtists     Int      @default(0)
  tier5Artists    Int      @default(0)
  tier20Artists   Int      @default(0)
  tier50Artists   Int      @default(0)
  tier120Artists  Int      @default(0)

  // Distribution tracking
  distributedAt   DateTime?
  distributionComplete Boolean @default(false)

  metadata        Json?
}

// Individual artist's monthly radio earnings
model RadioEarnings {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  artistId    String
  period      String   // "2024-12", "2025-01", etc.

  tier        String   // FREE, TIER_5, etc.
  shares      Int      // Number of shares
  earnings    Float    // shares * perShareValue

  paid        Boolean  @default(false)
  paidAt      DateTime?

  metadata    Json?

  @@unique([artistId, period])
  @@index([period])
  @@index([paid])
}

// Sponsors (Harper's Team)
model Sponsor {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Basic Info
  businessName      String
  contactName       String?
  email             String?  @unique
  phone             String?  @unique
  businessType      String   // "music_shop", "craft_maker", "venue", "restaurant", etc.

  // Discovery Source
  discoverySource   String
  sourceUrl         String?

  // Location
  city              String?
  state             String?

  // Status in Harper's Pipeline
  status            SponsorStatus @default(DISCOVERED)
  pipelineStage     String        @default("discovery") // discovery, contacted, interested, negotiating, closed, active

  // Contact tracking
  lastContactedAt   DateTime?
  nextFollowUpAt    DateTime?
  emailsSent        Int       @default(0)
  textsSent         Int       @default(0)
  callsCompleted    Int       @default(0)

  // Deal info
  sponsorshipTier   String?  // "bronze", "silver", "gold", "platinum"
  monthlyAmount     Float?
  contractStart     DateTime?
  contractEnd       DateTime?

  // Assignment
  assignedTo        String?  // "harper_ai", "human_closer", team member name

  // Relationships
  conversations     SponsorConversation[]
  calls             SponsorCall[]
  sponsorships      Sponsorship[]
  growthPartner     SponsorGrowthPartner?
  commissions       SponsorCommission[]

  // Soft Delete & Optimistic Locking
  deletedAt         DateTime?    // Soft delete timestamp
  version           Int      @default(1) // Optimistic locking version

  metadata          Json?

  // Indexes for performance
  @@index([status])
  @@index([pipelineStage])
  @@index([sponsorshipTier])
  @@index([lastContactedAt])
  @@index([nextFollowUpAt])
  @@index([deletedAt])
}

enum SponsorStatus {
  DISCOVERED
  CONTACTED
  INTERESTED
  NEGOTIATING
  CLOSED
  ACTIVE
  CHURNED
  UNRESPONSIVE
}

// Sponsor conversations
model SponsorConversation {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sponsorId   String
  sponsor     Sponsor  @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  channel     String   // "email", "sms", "voice_ai"
  messages    SponsorMessage[]

  isActive    Boolean  @default(true)
  handedOffTo String?  // "human_closer", team member name

  metadata    Json?
}

model SponsorMessage {
  id              String              @id @default(cuid())
  createdAt       DateTime            @default(now())

  conversationId  String
  conversation    SponsorConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  role            String   // "harper", "sponsor", "system", "human"
  content         String
  aiProvider      String?

  intent          String?  // "outreach", "educate", "pitch", "negotiate", "close"
  sentiment       String?

  metadata        Json?
}

// Call tracking
model SponsorCall {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  sponsorId   String
  sponsor     Sponsor  @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  callType    String   // "voice_ai", "human"
  duration    Int?     // seconds
  outcome     String?  // "interested", "not_interested", "callback", "closed"
  recording   String?  // URL to call recording
  transcript  String?

  handledBy   String?  // "harper_ai", team member name

  metadata    Json?
}

// Active sponsorships
model Sponsorship {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  sponsorId   String
  sponsor     Sponsor  @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  tier        String   // "bronze", "silver", "gold", "platinum"
  monthlyAmount Float
  startDate   DateTime
  endDate     DateTime?

  status      String   @default("active") // active, paused, cancelled

  // Benefits tracking
  adSpotsPerMonth   Int?
  socialMentions    Int?
  eventPromotion    Boolean @default(false)

  metadata    Json?

  // Indexes for performance
  @@index([status])
  @@index([sponsorId])
  @@index([startDate])
  @@index([endDate])
}

// Track submissions from artists
model TrackSubmission {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  artistId    String

  // Track info
  trackTitle  String
  trackUrl    String?  // URL to audio file
  genre       String?
  duration    Int?     // seconds

  // Status
  status      String   @default("pending") // pending, approved, rejected, live
  reviewedBy  String?
  reviewedAt  DateTime?

  // Airplay tracking
  addedToRotation Boolean @default(false)
  playCount   Int      @default(0)

  metadata    Json?
}

// Harper's activity log
model HarperActivity {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  action      String   // "discovered_sponsor", "sent_email", "completed_call", "closed_deal"
  sponsorId   String?
  details     Json?

  aiProvider  String?
  successful  Boolean  @default(true)
}

// System configuration
model Config {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  updatedAt   DateTime @updatedAt
}

// =============================================================================
// TEAM ELLIOT - LISTENER GROWTH ENGINE
// =============================================================================

// Listeners (anonymous or identified)
model Listener {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Identity (optional)
  email             String?  @unique
  name              String?
  phone             String?  @unique

  // Discovery
  discoverySource   String   // "artist_referral", "social_media", "organic", "search", "ad"
  referringArtistId String?  // If came from artist promotion
  sourceUrl         String?

  // Listening Behavior
  totalSessions     Int      @default(0)
  totalListeningHours Float  @default(0)
  averageSessionLength Float @default(0)
  lastListenedAt    DateTime?
  favoriteTimeSlot  String?  // "morning", "midday", "evening", "late_night"

  // Engagement Level
  engagementScore   Int      @default(0) // 0-100
  status            ListenerStatus @default(NEW)
  tier              ListenerTier   @default(CASUAL)

  // Habit Formation
  listeningStreak   Int      @default(0) // consecutive days
  preferredDJ       String?  // "hank", "june", "aj"
  notificationsEnabled Boolean @default(false)

  // Community
  communityMember   Boolean  @default(false)
  discordId         String?
  facebookId        String?

  // Referral tracking
  referredByCode    String?   // referral code used at registration
  referredByType    String?   // "scout", "artist", "sponsor", "listener"

  // Gamification
  xpTotal           Int      @default(0)
  xpLevel           Int      @default(1)
  badges            String?  // JSON array of badge IDs earned

  // Relationships
  sessions          ListeningSession[]
  engagements       ListenerEngagement[]
  campaignResponses CampaignResponse[]
  scout             Scout?
  referredBy        ListenerReferral[]
  playbacks         ListenerPlayback[]
  sponsorReferral   SponsorListenerReferral?
  referralChains    SponsorReferralChain[]

  metadata          Json?
}

enum ListenerStatus {
  NEW             // First 7 days
  ACTIVE          // Regular listener
  POWER_USER      // 5+ sessions/week
  AT_RISK         // Hasn't listened in 14 days
  CHURNED         // Hasn't listened in 30 days
  REACTIVATED     // Returned after churn
}

enum ListenerTier {
  CASUAL          // 1-2 sessions/week
  REGULAR         // 3-4 sessions/week
  SUPER_FAN       // 5+ sessions/week
  EVANGELIST      // Shares content, refers others
}

// Individual listening sessions
model ListeningSession {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  listenerId  String?
  listener    Listener? @relation(fields: [listenerId], references: [id], onDelete: SetNull)

  // Session details
  startTime   DateTime
  endTime     DateTime?
  duration    Int?      // minutes
  timeSlot    String    // "morning", "midday", "evening", "late_night"
  djName      String?   // "hank", "june", "aj"

  // Content consumed
  tracksHeard Int       @default(0)
  adsHeard    Int       @default(0)
  sponsorsHeard String? // JSON array of sponsor names

  // Device/Platform
  device      String?   // "web", "mobile", "smart_speaker"
  location    String?   // City/state if available

  metadata    Json?
}

// Viral content created by Team Elliot
model ViralContent {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Content details
  type        String   // "tiktok", "reel", "short", "story", "post"
  title       String
  description String?
  contentUrl  String?  // URL to video/image
  platform    String   // "tiktok", "instagram", "youtube", "facebook"

  // Created by
  createdBy   String   // "nova", "river", "sage", "elliot"
  category    String   // "artist_spotlight", "dj_moment", "behind_scenes", "listener_story"

  // Artist connection
  artistId    String?
  artistName  String?

  // Performance
  views       Int      @default(0)
  likes       Int      @default(0)
  shares      Int      @default(0)
  comments    Int      @default(0)
  newListeners Int     @default(0) // Tracked conversions

  // Status
  status      String   @default("draft") // draft, published, archived
  publishedAt DateTime?

  metadata    Json?
}

// Growth campaigns
model GrowthCampaign {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Campaign details
  name        String
  type        String   // "artist_referral", "viral_push", "habit_builder", "community_event"
  status      String   @default("active") // active, paused, completed

  // Targeting
  targetAudience String // "new_listeners", "at_risk", "power_users", "all"
  channel     String   // "social", "email", "push", "sms", "community"

  // Managed by
  managedBy   String   // "elliot", "nova", "river", "sage", "orion"

  // Goals
  goalType    String   // "listeners", "sessions", "retention", "virality"
  goalTarget  Int      // Target number
  goalReached Int      @default(0)

  // Timing
  startDate   DateTime
  endDate     DateTime?

  // Results
  responses   CampaignResponse[]

  metadata    Json?
}

// Campaign responses/interactions
model CampaignResponse {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  campaignId  String
  campaign    GrowthCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  listenerId  String?
  listener    Listener? @relation(fields: [listenerId], references: [id], onDelete: SetNull)

  // Response
  action      String   // "clicked", "listened", "shared", "joined", "ignored"
  converted   Boolean  @default(false) // Did they complete the goal?

  metadata    Json?
}

// Listener engagement (comments, shares, participation)
model ListenerEngagement {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  listenerId  String?
  listener    Listener? @relation(fields: [listenerId], references: [id], onDelete: SetNull)

  // Engagement type
  type        String   // "comment", "share", "referral", "contest_entry", "community_post"
  platform    String?  // "discord", "facebook", "instagram", "tiktok"

  // Content
  content     String?
  targetUrl   String?  // What they engaged with

  // Value
  sentiment   String?  // "positive", "neutral", "negative"

  metadata    Json?
}

// Elliot team activity log
model ElliotActivity {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  // Action
  action      String   // "created_content", "launched_campaign", "activated_listener", "sent_notification"
  teamMember  String   // "elliot", "nova", "river", "sage", "orion"

  // Related entities
  listenerId  String?
  artistId    String?
  campaignId  String?

  details     Json?
  successful  Boolean  @default(true)
}

// =============================================================================
// STATION PROGRAMMING & DJ SYSTEM
// =============================================================================

// DJ Personalities
model DJ {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Basic info
  name        String   // "Hank Westwood", "Loretta Merrick", etc.
  slug        String   @unique // "hank-westwood", "loretta-merrick"
  fullName    String?  // Full character name if different

  // Character profile
  bio         String   // Full bio text
  age         String?  // "Late 40s", "Early 30s"
  background  String?  // Character background story
  vibe        String?  // "Blue-collar optimism, working-class pride"
  tagline     String?  // "Pour the coffee. Fire up the engine."

  // Voice & personality
  voiceDescription String? // "Gravel and warmth, like coffee and worn denim"
  personalityTraits String? // JSON array of traits
  musicalFocus String?      // Description of music they play

  // AI Voice config
  voiceProfileId     String?  // ElevenLabs voice ID
  voiceStability     Float    @default(0.75)
  voiceSimilarityBoost Float  @default(0.75)
  ttsVoice           String?  // TTS voice name (OpenAI: alloy, ash, etc. Gemini: Leda, Zephyr, etc.)
  ttsProvider        String   @default("openai") // "openai" or "gemini"

  // AI Personality config
  gptSystemPrompt    String?  // AI personality prompt
  gptTemperature     Float    @default(0.8)

  // Character & Personality
  catchPhrases        String?  // Signature phrases, one per line
  additionalKnowledge String?  // Extra character knowledge for AI context

  // Expanded character profile
  hometown        String?  // "Austin, TX", "Small town outside Nashville"
  showFormat      String?  // "Morning Drive Americana", "The Afternoon Hang"
  onAirStyle      String?  // How they intro songs, interview, talk to listeners, humor, tone
  quirksAndHabits String?  // Recurring bits, pet peeves, studio behaviors
  atmosphere      String?  // Sensory mood of the show â€” what it feels like to listen
  philosophy      String?  // Guiding belief about music, radio, and connection

  // Visual identity
  photoUrl    String?
  colorPrimary String?   // Hex color for show branding
  colorSecondary String?

  // Station relation
  stationId   String?
  station     Station?  @relation("StationDJs", fields: [stationId], references: [id], onDelete: SetNull)

  // Status
  isActive    Boolean  @default(true)
  isWeekend   Boolean  @default(false) // Weekend-only DJ
  priority    Int      @default(0)     // For ordering

  // Relationships
  shows       DJShow[]
  trackPlays  TrackPlayback[]
  clockAssignments ClockAssignment[]

  metadata    Json?

  @@index([isActive])
  @@index([slug])
  @@index([stationId])
}

// DJ Shows/Time Slots
model DJShow {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  djId        String
  dj          DJ       @relation(fields: [djId], references: [id], onDelete: Cascade)

  // Show details
  name        String   // "Sunrise & Steel", "Desert Folk Dispatch"
  slug        String   @unique // "sunrise-and-steel"
  description String?  // Full show description

  // Schedule
  dayOfWeek   Int      // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
  startTime   String   // "06:00" in 24-hour format
  endTime     String   // "10:00" in 24-hour format
  duration    Int      // minutes (e.g., 240 for 4 hours)

  // Programming focus
  mood        String?  // "Morning ritual, working-class pride"
  musicalFocus String? // Genre/style focus for this time slot
  tempoStyle  String?  // "Upbeat but not jarring", "Slow, contemplative"

  // Show identity
  soundbedUrl String?  // Intro/outro audio
  visualUrl   String?  // Show artwork

  // Status
  isActive    Boolean  @default(true)
  isSpecial   Boolean  @default(false) // Special programming vs regular show

  // Relationships
  trackPlays  TrackPlayback[]
  programmingBlocks ProgrammingBlock[]

  metadata    Json?

  @@index([djId])
  @@index([dayOfWeek])
  @@index([isActive])
}

// Track playback history
model TrackPlayback {
  id          String   @id @default(cuid())
  playedAt    DateTime @default(now())

  // Track info
  trackId     String?  // Link to TrackSubmission if applicable
  trackTitle  String
  artistName  String
  artistId    String?  // Link to Artist if applicable
  duration    Int?     // seconds

  // Playback context
  djId        String?
  dj          DJ?      @relation(fields: [djId], references: [id], onDelete: SetNull)

  showId      String?
  show        DJShow?  @relation(fields: [showId], references: [id], onDelete: SetNull)

  timeSlot    String   // "morning", "midday", "evening", "late_night"

  // Programming context
  wasScheduled Boolean  @default(true)
  wasRequested Boolean  @default(false)
  requestedBy  String?  // Listener ID if it was a request

  // Analytics
  listenerCount Int?    // How many were listening
  skipCount    Int      @default(0)
  likeCount    Int      @default(0)

  metadata    Json?

  @@index([playedAt])
  @@index([artistId])
  @@index([djId])
  @@index([showId])
  @@index([timeSlot])
}

// Special programming blocks
model ProgrammingBlock {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Block details
  name        String   // "New Artist Showcase", "Songwriter Session"
  description String?
  type        String   // "weekly_feature", "monthly_special", "seasonal", "event"

  // Schedule
  djShowId    String?
  djShow      DJShow?  @relation(fields: [djShowId], references: [id], onDelete: SetNull)

  dayOfWeek   Int?     // null if recurring across multiple days
  timeSlot    String?  // "morning", "midday", "evening", "late_night"
  duration    Int?     // minutes

  // Recurrence
  frequency   String   // "weekly", "monthly", "seasonal", "one_time"
  nextOccurrence DateTime?

  // Content focus
  theme       String?  // "Texas Songwriter Night", "Deep Cuts Vinyl Night"
  curatedBy   String?  // DJ or team member who curates

  // Status
  isActive    Boolean  @default(true)
  startDate   DateTime
  endDate     DateTime?

  metadata    Json?

  @@index([djShowId])
  @@index([isActive])
  @@index([nextOccurrence])
}

// Station configuration
model Station {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Station identity
  name        String   // "North Country Radio"
  callSign    String?  // "NCR"
  tagline     String?  // "Where the music finds you"
  description String?
  stationCode String?  @unique // URL-safe slug ("ncr", "southern-soul")

  // Format
  formatType  String?  // "americana", "country", "rock", "jazz", "blues", "folk"
  musicEra    String?  // "classic", "modern", "mixed"

  // Branding
  logoUrl     String?
  primaryColor String?
  secondaryColor String?
  genre       String   // "Americana, Country, Singer-Songwriter"

  // Station capacity (based on docs)
  maxTracksPerMonth  Int @default(8640)  // 12 tracks/hour * 24 hours * 30 days
  maxAdsPerMonth     Int @default(17280) // 24 ad spots/hour * 24 hours * 30 days
  maxArtistCapacity  Int @default(340)   // Artist capacity
  maxSponsorCapacity Int @default(125)   // Sponsor capacity
  targetDAU          Int @default(1250)  // Target Daily Active Users

  // Programming hours
  primeHoursStart    String @default("06:00")
  primeHoursEnd      String @default("18:00")

  // Stream config
  streamUrl          String?
  backupStreamUrl    String?
  streamBitrate      Int     @default(128)
  streamFormat       String  @default("mp3")

  // Crossfade
  crossfadeEnabled   Boolean @default(true)
  crossfadeDuration  Float   @default(3.0)
  crossfadeStartNext Float   @default(1.5)
  crossfadeFadeIn    Float   @default(0.8)
  crossfadeFadeOut   Float   @default(1.5)
  crossfadeCurve     String  @default("equal_power")

  // Normalization
  normalizationEnabled Boolean @default(true)
  normalizationTarget  Float   @default(-14.0)
  normalizationWindow  Float   @default(0.1)
  normalizationGainMax Float   @default(10.0)
  normalizationGainMin Float   @default(-10.0)

  // Compression
  compressionEnabled   Boolean @default(true)
  compressionAttack    Float   @default(50.0)
  compressionRelease   Float   @default(400.0)
  compressionRatio     Float   @default(3.0)
  compressionThreshold Float   @default(-15.0)
  compressionKnee      Float   @default(1.0)

  // EQ (3-band)
  eqEnabled   Boolean @default(false)
  eqLowFreq   Int     @default(100)
  eqLowGain   Float   @default(2.0)
  eqMidFreq   Int     @default(1000)
  eqMidGain   Float   @default(0.0)
  eqHighFreq  Int     @default(8000)
  eqHighGain  Float   @default(1.0)

  // DJ Voice Ducking
  duckingEnabled Boolean @default(true)
  duckingAmount  Float   @default(-8.0)
  duckingAttack  Float   @default(200.0)
  duckingRelease Float   @default(500.0)

  // Subscription
  subscriptionTier   String  @default("starter") // "free", "starter", "pro", "enterprise"

  // Owner info
  ownerName          String?
  ownerEmail         String?

  // Setup wizard
  setupStep          Int     @default(0)
  setupComplete      Boolean @default(false)

  // Status
  isActive           Boolean @default(true)
  launchDate         DateTime?

  // Relations
  songs              Song[]
  clockTemplates     ClockTemplate[]
  clockAssignments   ClockAssignment[]
  imagingVoices      StationImagingVoice[]
  stationDJs         DJ[]    @relation("StationDJs")
  showTransitions    ShowTransition[]
  musicBeds          MusicBed[]
  sponsorAds         SponsorAd[]

  metadata    Json?
}

// =============================================================================
// TEAM CASSIDY - SUBMISSION REVIEW & ROTATION CURATION
// =============================================================================

// Submission for review panel
model Submission {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Artist info
  artistId          String
  artistName        String
  artistEmail       String?
  artistPhone       String?

  // Track details
  trackTitle        String
  trackFileUrl      String   // URL to audio file
  trackDuration     Int?     // seconds
  genre             String?
  genreTags         String?  // JSON array

  // Submission context (from Riley)
  discoverySource   String?  // "Newport Folk Festival", venue, etc.
  discoveredBy      String?  // Riley team member
  rileyContext      Json?    // Discovery metadata

  // Review status
  status            SubmissionStatus @default(PENDING)
  submissionType    String   @default("initial") // initial, progression_request

  // Judging timeline
  judgingStartedAt  DateTime?
  judgingCompletedAt DateTime?

  // Final decision
  tierAwarded       RotationTier?
  awardedAt         DateTime?
  rotationSpinsWeekly Int?
  decisionRationale String?  // Cassidy's summary

  // Progression pathway
  upgradePathway    Json?    // Next tier, timeline, improvements needed

  // Revenue
  premiumFastTrack  Boolean  @default(false)
  fastTrackFee      Float?

  // Relationships
  reviews           SubmissionReview[]
  tierHistory       TierPlacement[]

  metadata          Json?

  @@index([status])
  @@index([artistId])
  @@index([tierAwarded])
  @@index([judgingStartedAt])
}

enum SubmissionStatus {
  PENDING           // Awaiting review
  IN_REVIEW         // Being judged
  JUDGED            // Decision made
  PLACED            // Added to rotation
  NOT_PLACED        // Not accepted (~5%)
}

enum RotationTier {
  BRONZE            // 4-6 spins/week
  SILVER            // 10-14 spins/week
  GOLD              // 20-25 spins/week
  PLATINUM          // 30+ spins/week
}

// Individual judge reviews
model SubmissionReview {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  submissionId      String
  submission        Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  judgeId           String
  judge             Judge    @relation(fields: [judgeId], references: [id], onDelete: Cascade)

  // Numerical scores (0-100)
  overallScore      Int?
  productionQuality Int?
  commercialViability Int?
  artisticMerit     Int?
  performanceQuality Int?
  culturalSignificance Int?
  growthPotential   Int?

  // Qualitative assessment
  strengths         String?
  growthAreas       String?
  tierRecommendation RotationTier?
  upgradePathwayAdvice String?

  // Judge-specific notes
  technicalNotes    String?  // Dakota Wells
  programmingNotes  String?  // Maya Reeves
  performanceNotes  String?  // Jesse Coleman
  musicologicalNotes String? // Dr. Sam Chen
  audienceNotes     String?  // Whitley Cross

  // Meta
  scoredAt          DateTime @default(now())

  @@unique([submissionId, judgeId])
  @@index([submissionId])
  @@index([judgeId])
}

// Panel judges
model Judge {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Basic info
  name              String
  role              String   // "Music Director", "Production Engineer", etc.
  expertiseArea     String?  // "Technical assessment", "Commercial viability", etc.
  bio               String?

  // Performance metrics
  avgScoreAccuracy  Float?   // How well predictions match final tiers
  judgingConsistency Float?  // Inter-judge agreement
  totalSubmissionsJudged Int @default(0)

  // Status
  isActive          Boolean  @default(true)
  availabilitySchedule Json?

  // Relationships
  reviews           SubmissionReview[]

  metadata          Json?

  @@index([isActive])
}

// Tier placement history
model TierPlacement {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  submissionId      String?
  submission        Submission? @relation(fields: [submissionId], references: [id], onDelete: SetNull)

  artistId          String
  artistName        String

  // Tier change
  previousTier      RotationTier?
  newTier           RotationTier
  changeDate        DateTime @default(now())
  reason            String?
  decidedBy         String   // "Cassidy Monroe", "Panel Consensus"

  // Judge scores summary
  judgeScores       Json?

  // Progression context
  isProgression     Boolean  @default(false)
  timeInPreviousTierDays Int?
  improvementNotes  String?

  metadata          Json?

  @@index([artistId])
  @@index([newTier])
  @@index([changeDate])
}

// Progression/upgrade requests
model ProgressionRequest {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  artistId          String
  artistName        String
  submissionId      String

  // Request details
  currentTier       RotationTier
  requestedTier     RotationTier
  requestDate       DateTime @default(now())
  timeSinceLastTierDays Int?

  // Artist's claims
  improvementsClaimed String?
  newMaterialDescription String?

  // Riley support
  rileyRecommendation String?
  rileyConfidenceScore Int?

  // Review status
  reviewStatus      String   @default("pending") // pending, approved, denied, needs_more_time
  reviewDate        DateTime?
  reviewerId        String?  // Judge ID
  decisionRationale String?

  // Outcome
  upgradeApproved   Boolean?
  newTierIfApproved RotationTier?
  timelineToResubmit String?

  metadata          Json?

  @@index([artistId])
  @@index([reviewStatus])
  @@index([currentTier])
}

// Panel review meetings
model PanelMeeting {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  meetingDate       DateTime
  meetingType       String   // "tuesday_session", "thursday_session", "monthly_strategy"

  // Attendees (JSON arrays of IDs)
  judgesPresent     String?  // JSON array of judge IDs
  rileyRepPresent   String?
  harperRepPresent  String?
  elliottRepPresent String?

  // Submissions reviewed
  submissionsReviewed String? // JSON array of submission IDs
  tiersAssigned     Json?     // {submission_id: tier}

  // Meeting notes
  discussionSummary String?
  strategicDecisions Json?
  actionItems       Json?

  // Metrics
  submissionsJudgedCount Int?
  avgJudgingTimeMinutes Int?
  consensusReachedCount Int?
  splitDecisionsCount Int?

  metadata          Json?

  @@index([meetingDate])
  @@index([meetingType])
}

// Rotation slots for programming
model RotationSlot {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Time configuration
  daypart           String   // "morning_drive", "midday", "afternoon_drive", "evening", "overnight", "weekend"
  dayOfWeek         Int      // 0-6 (Sunday-Saturday)
  timeStart         String   // "HH:MM"
  timeEnd           String   // "HH:MM"

  // Current assignment
  currentArtistId   String?
  currentArtistName String?
  currentTrackId    String?
  currentTier       RotationTier?
  indieVsMainstream String   @default("mainstream") // "indie", "mainstream"

  // Replacement strategy
  replacementCandidateArtistId String?
  replacementReadinessScore Int?
  replacementScheduledDate DateTime?

  // Sponsor integration (Harper)
  sponsorId         String?
  sponsorIntegrationType String? // "pre_roll", "post_roll", "artist_spotlight"

  // Performance (Elliott)
  avgEngagementScore Float?
  skipRate          Float?
  listenerFeedback  Json?

  // 80/20 transformation
  mainstreamReplaced Boolean @default(false)
  replacedAt        DateTime?
  progressContribution Float?

  metadata          Json?

  @@index([daypart])
  @@index([currentTier])
  @@index([mainstreamReplaced])
}

// Cassidy team activity log
model CassidyActivity {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  action            String   // "reviewed_submission", "assigned_tier", "approved_progression", "scheduled_meeting"
  submissionId      String?
  artistId          String?
  judgeId           String?
  details           Json?

  successful        Boolean  @default(true)

  @@index([action])
  @@index([createdAt])
}

// =============================================================================
// TEAM ELLIOT - ARTIST DISCOVERY PIPELINE (SCOUT SYSTEM)
// =============================================================================

// Scout profiles (listeners who discover and refer artists)
model Scout {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Link to Listener
  listenerId        String   @unique
  listener          Listener @relation(fields: [listenerId], references: [id], onDelete: Cascade)

  // Scout Profile
  status            ScoutStatus @default(PENDING)
  activatedAt       DateTime?

  // Unique referral code
  referralCode      String   @unique

  // Performance tracking
  totalEarnings     Float    @default(0)
  totalCommissions  Float    @default(0)
  lifetimeValue     Float    @default(0)

  // Counts
  artistDiscoveries Int      @default(0)
  listenerReferrals Int      @default(0)
  activeArtists     Int      @default(0) // Currently paying artists

  // Payout info
  payoutEmail       String?
  bankAccountId     String?  // Manifest Financial external account ID
  taxId             String?  // For 1099 purposes

  // Relationships
  discoveries       ArtistDiscovery[]
  referrals         ListenerReferral[]
  commissions       ScoutCommission[]
  prepurchases      AirplayPrepurchase[]

  metadata          Json?

  @@index([referralCode])
  @@index([status])
}

enum ScoutStatus {
  PENDING       // Registered but not activated
  ACTIVE        // Active scout
  SUSPENDED     // Temporarily suspended
  INACTIVE      // Self-deactivated
}

// Artist discoveries by scouts
model ArtistDiscovery {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Scout who discovered the artist
  scoutId           String
  scout             Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)

  // Artist discovered
  artistId          String
  artist            Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  // Discovery details
  discoverySource   String   // How found: "instagram", "tiktok", "spotify", "live_show", "other"
  sourceUrl         String?
  notes             String?

  // Status tracking
  status            DiscoveryStatus @default(PENDING)
  contactedAt       DateTime?
  convertedAt       DateTime?  // When artist upgraded to paid tier
  firstPurchaseDate DateTime?

  // Commission tracking
  commissionRate    Float    @default(0.20) // Default 20% for first 3 months
  hasConverted      Boolean  @default(false)
  isPrepurchase     Boolean  @default(false) // True if from prepurchase

  // Relationships
  commissions       ScoutCommission[]

  metadata          Json?

  @@unique([scoutId, artistId]) // One scout per artist discovery
  @@index([scoutId])
  @@index([artistId])
  @@index([status])
}

enum DiscoveryStatus {
  PENDING       // Submitted, not yet contacted
  CONTACTED     // Riley reached out
  ENGAGED       // Artist responded
  CONVERTED     // Artist purchased tier
  INACTIVE      // Artist churned
  REJECTED      // Not a good fit
}

// Listener referrals by scouts
model ListenerReferral {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  // Scout who referred
  scoutId           String
  scout             Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)

  // Listener referred
  listenerId        String
  listener          Listener @relation(fields: [listenerId], references: [id], onDelete: Cascade)

  // Referral tracking
  referralSource    String?  // "facebook", "instagram", "direct_link", etc.
  convertedAt       DateTime?

  metadata          Json?

  @@unique([scoutId, listenerId])
  @@index([scoutId])
  @@index([listenerId])
}

// Scout commission records
model ScoutCommission {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  // Scout earning commission
  scoutId           String
  scout             Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)

  // Source of commission
  discoveryId       String?
  discovery         ArtistDiscovery? @relation(fields: [discoveryId], references: [id], onDelete: SetNull)

  artistId          String
  artist            Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  // Commission details
  type              CommissionType
  period            String   // "2025-01", "2025-02", etc.

  // Financial
  artistTier        String   // "TIER_5", "TIER_20", etc.
  artistPayment     Float    // Artist's tier payment for this period
  commissionRate    Float    // 0.20 (20%) or 0.10 (10%) or 0.25 (25% for prepurchase)
  commissionAmount  Float    // Calculated commission

  // Bonus tracking
  isUpgradeBonus    Boolean  @default(false) // $10 upgrade bonus
  isInfluenceBonus  Boolean  @default(false) // $2 network influence bonus
  bonusAmount       Float    @default(0)

  // Total
  totalAmount       Float    // commissionAmount + bonusAmount

  // Payout status
  status            CommissionStatus @default(PENDING)
  paidAt            DateTime?
  payoutId          String?  // Manifest Financial payout ID

  // Metadata
  monthsSinceConversion Int?  // Track if in 20% or 10% phase

  metadata          Json?

  @@unique([scoutId, artistId, period]) // One commission per artist per period
  @@index([scoutId])
  @@index([artistId])
  @@index([period])
  @@index([status])
}

enum CommissionType {
  RECURRING         // Monthly tier commission (20% or 10%)
  UPGRADE_BONUS     // $10 tier upgrade bonus
  INFLUENCE_BONUS   // $2 network influence bonus
  PREPURCHASE       // 25% lifetime from prepurchase conversion
}

enum CommissionStatus {
  PENDING           // Awaiting payout
  PROCESSING        // Being processed
  PAID              // Successfully paid
  FAILED            // Payment failed
  CANCELLED         // Commission cancelled
}

// Airplay prepurchase by scouts
model AirplayPrepurchase {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Scout who purchased
  scoutId           String
  scout             Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)

  // Purchase details
  amountPaid        Float    // $80
  creditValue       Float    // $100 worth of airplay

  // Target artist
  targetArtistId    String?
  targetArtistEmail String?
  targetArtistName  String?

  // Redemption
  status            PrepurchaseStatus @default(PENDING)
  redeemedAt        DateTime?
  redeemedBy        String?  // Artist ID who redeemed

  // Commission tracking
  hasConverted      Boolean  @default(false) // Artist became paying customer
  conversionDate    DateTime?

  // Payment
  paymentIntentId   String?  // Manifest payment ID
  transactionId     String?

  metadata          Json?

  @@index([scoutId])
  @@index([targetArtistId])
  @@index([status])
}

enum PrepurchaseStatus {
  PENDING           // Purchased, not yet sent
  SENT              // Sent to artist
  REDEEMED          // Artist activated airplay
  CONVERTED         // Artist upgraded to paid
  EXPIRED           // Never redeemed (after 90 days)
}

// Listener playback tracking (for influence bonus)
model ListenerPlayback {
  id                String   @id @default(cuid())
  playedAt          DateTime @default(now())

  // Listener
  listenerId        String
  listener          Listener @relation(fields: [listenerId], references: [id], onDelete: Cascade)

  // Track played
  trackId           String?
  trackTitle        String
  artistId          String
  artistName        String

  // Session context
  sessionId         String?
  duration          Int?     // Seconds listened
  completedTrack    Boolean  @default(false)

  metadata          Json?

  @@index([listenerId, artistId]) // For influence queries
  @@index([playedAt])
  @@index([artistId])
}

// =============================================================================
// HARPER'S TEAM - SPONSOR GROWTH PARTNER SYSTEM
// =============================================================================

// Sponsor Growth Partner profiles (sponsors who drive listener/artist growth)
model SponsorGrowthPartner {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Link to Sponsor
  sponsorId         String   @unique
  sponsor           Sponsor  @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  // Growth Partner Profile
  status            GrowthPartnerStatus @default(ACTIVE)
  activatedAt       DateTime @default(now())
  tier              GrowthPartnerTier   @default(BRONZE)

  // Unique referral code
  referralCode      String   @unique

  // Performance tracking
  totalEarnings     Float    @default(0)
  totalCommissions  Float    @default(0)

  // Counts
  listenersReferred Int      @default(0)
  activeListeners   Int      @default(0) // Currently verified active (15+ hours/month)
  artistsBacked     Int      @default(0)
  networkDepth      Int      @default(0) // Max chain depth achieved

  // Tier tracking
  lastTierUpdate    DateTime?
  tierAchievedAt    DateTime?

  // Relationships
  listenerReferrals SponsorListenerReferral[]
  artistDevelopment SponsorArtistDevelopment[]
  commissions       SponsorCommission[]
  bulkPurchases     SponsorBulkPurchase[]
  referralChains    SponsorReferralChain[]

  metadata          Json?

  @@index([referralCode])
  @@index([tier])
  @@index([status])
}

enum GrowthPartnerStatus {
  ACTIVE        // Active growth partner
  INACTIVE      // Temporarily inactive
  SUSPENDED     // Suspended
}

enum GrowthPartnerTier {
  BRONZE        // 100+ listeners
  SILVER        // 500+ listeners
  GOLD          // 1,000+ listeners
  PLATINUM      // 5,000+ listeners
}

// Listener referrals by sponsors
model SponsorListenerReferral {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Growth partner who referred
  growthPartnerId   String
  growthPartner     SponsorGrowthPartner @relation(fields: [growthPartnerId], references: [id], onDelete: Cascade)

  // Listener referred
  listenerId        String   @unique
  listener          Listener @relation(fields: [listenerId], references: [id], onDelete: Cascade)

  // Verification tracking
  isActive          Boolean  @default(false) // 15+ hours/month
  lastVerifiedMonth String?  // "2025-01"
  totalHoursThisMonth Float  @default(0)

  // Bounty tracking
  bountyTier        Int      @default(0) // 0=not paid, 1=$1, 2=$1.50, 3=$2, 4=$2.50
  totalBountiesPaid Float    @default(0)

  // Referral source
  referralSource    String?  // "email", "facebook", "in_store", etc.
  convertedAt       DateTime @default(now())

  metadata          Json?

  @@index([growthPartnerId])
  @@index([isActive])
  @@index([lastVerifiedMonth])
}

// Artist development via bulk purchases
model SponsorArtistDevelopment {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Growth partner backing the artist
  growthPartnerId   String
  growthPartner     SponsorGrowthPartner @relation(fields: [growthPartnerId], references: [id], onDelete: Cascade)

  // Artist being backed
  artistId          String
  artist            Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  // From bulk purchase
  bulkPurchaseId    String?
  bulkPurchase      SponsorBulkPurchase? @relation(fields: [bulkPurchaseId], references: [id], onDelete: SetNull)

  // Credit allocation
  creditAllocated   Float    // Amount of airplay credit allocated to this artist
  creditUsed        Float    @default(0)
  creditRemaining   Float    // creditAllocated - creditUsed

  // Conversion tracking
  hasConverted      Boolean  @default(false) // Artist upgraded to paid tier
  convertedAt       DateTime?
  conversionTier    String?  // "TIER_5", "TIER_20", etc.

  // Commission tracking
  commissionRate    Float    @default(0.20) // 20% lifetime
  totalCommissions  Float    @default(0)

  // Donation tracking
  totalDonations    Float    @default(0)
  donationCommissions Float  @default(0)

  metadata          Json?

  @@unique([growthPartnerId, artistId])
  @@index([growthPartnerId])
  @@index([artistId])
  @@index([hasConverted])
}

// Add relationship to Artist model
// (This will be added as: artistDevelopment SponsorArtistDevelopment[])

// Sponsor commission records
model SponsorCommission {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  // Growth partner earning commission
  growthPartnerId   String?
  growthPartner     SponsorGrowthPartner? @relation(fields: [growthPartnerId], references: [id], onDelete: SetNull)

  // Sponsor (for backwards compatibility if not growth partner)
  sponsorId         String
  sponsor           Sponsor  @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  // Commission details
  type              SponsorCommissionType
  period            String   // "2025-01", "2025-02", etc.

  // Financial
  baseAmount        Float    // Base amount commission is calculated from
  commissionRate    Float    // 0.50 (listener), 0.15 (artist discovery), 0.20 (development), etc.
  commissionAmount  Float    // Calculated commission

  // Source tracking
  sourceId          String?  // ListenerReferral, ArtistDevelopment, etc.
  sourceType        String?  // "listener", "artist", "network", "ad_revenue"

  // Payout status
  status            SponsorCommissionStatus @default(PENDING)
  paidAt            DateTime?
  payoutId          String?  // Manifest Financial payout ID

  // Metadata
  bountyTier        Int?     // For listener bounties (1-4)
  chainDepth        Int?     // For network effects (1-2)

  metadata          Json?

  @@unique([sponsorId, type, period, sourceId])
  @@index([growthPartnerId])
  @@index([sponsorId])
  @@index([period])
  @@index([status])
  @@index([type])
}

enum SponsorCommissionType {
  LISTENER_BOUNTY       // $0.50-$2.50 per active listener
  ARTIST_DISCOVERY      // 15% commission from network artists
  ARTIST_DEVELOPMENT    // 20% lifetime from backed artists
  NETWORK_EFFECT        // 5% from referral chains
  AD_REVENUE_SHARE      // 10% from referred listener ad revenue
  DONATION_COMMISSION   // 2% from artist donations
}

enum SponsorCommissionStatus {
  PENDING           // Awaiting payout
  PROCESSING        // Being processed
  PAID              // Successfully paid
  FAILED            // Payment failed
  CANCELLED         // Commission cancelled
}

// Network referral chains for network effect commissions
model SponsorReferralChain {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())

  // Origin sponsor
  growthPartnerId   String
  growthPartner     SponsorGrowthPartner @relation(fields: [growthPartnerId], references: [id], onDelete: Cascade)

  // Chain levels (max 2 deep)
  level1ListenerId  String   // Direct referral from sponsor
  level1Listener    Listener @relation(fields: [level1ListenerId], references: [id], onDelete: Cascade)

  level2ListenerId  String?  // Referral from level1

  // Event tracking
  eventType         String?  // "artist_purchase", "artist_upgrade", etc.
  eventValue        Float?   // Value of the event (e.g., $20 for TIER_20 purchase)
  commissionEarned  Float    @default(0) // 5% of eventValue

  metadata          Json?

  @@index([growthPartnerId])
  @@index([level1ListenerId])
}

// Bulk airplay purchases by sponsors
model SponsorBulkPurchase {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Growth partner purchasing
  growthPartnerId   String
  growthPartner     SponsorGrowthPartner @relation(fields: [growthPartnerId], references: [id], onDelete: Cascade)

  // Purchase details
  amountPaid        Float    // $1,000
  creditValue       Float    // $1,667 worth of airplay
  discountPercent   Float    @default(40) // 40% discount

  // Distribution
  creditsAllocated  Float    @default(0)
  creditsRemaining  Float    // creditValue - creditsAllocated

  // Expiry
  expiresAt         DateTime // 12 months from purchase
  isExpired         Boolean  @default(false)

  // Payment
  paymentIntentId   String?  // Manifest payment ID
  transactionId     String?

  // Relationships
  artistAllocations SponsorArtistDevelopment[]

  metadata          Json?

  @@index([growthPartnerId])
  @@index([expiresAt])
  @@index([isExpired])
}

// =============================================================================
// STATION MANAGEMENT SYSTEM - Songs, Clocks, Assignments, Imaging
// =============================================================================

// Song in a station's music library
model Song {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // Track info
  title           String
  artistName      String
  album           String?
  duration        Int?     // seconds
  genre           String?

  // File
  fileUrl         String?
  artworkUrl      String?

  // Music metadata
  bpm             Int?
  musicalKey      String?  // "C", "Am", "F#m"
  energy          Float?   // 0-1

  // Cue points
  introEnd          Float?
  outroStart        Float?
  crossfadeStart    Float?
  crossfadeDuration Float?  @default(3.0)
  mixInPoint        Float?
  mixOutPoint       Float?
  hookStart         Float?
  hookEnd           Float?
  cueDetectionMethod String? // "manual" or "ai_detected"
  cueConfidence     Float?   // 0-1
  cueNotes          String?

  // Rotation
  rotationCategory String  @default("C") // A/B/C/D/E â€” Hits/Fast/Medium/Slow/Indie
  vocalGender     String   @default("unknown") // male/female/mixed/instrumental/unknown
  tempoCategory   String   @default("medium") // very_slow/slow/medium/fast/very_fast

  // Status
  isActive        Boolean  @default(true)
  playCount       Int      @default(0)
  lastPlayedAt    DateTime?

  metadata        Json?

  @@index([stationId])
  @@index([rotationCategory])
  @@index([isActive])
}

// Clock template for scheduling music rotation
model ClockTemplate {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // Template info
  name            String   // "Morning Drive", "Midday Mix"
  description     String?
  clockType       String   @default("midday") // morning_drive/midday/evening/late_night/weekend

  // Music parameters
  tempo           String?  // "upbeat", "moderate", "laid_back"
  energyLevel     String?  // "high", "medium", "low"
  hitsPerHour     Int      @default(6)
  indiePerHour    Int      @default(3)
  genderBalanceTarget Float @default(0.5) // 0-1, target female ratio

  // Clock pattern: array of 20 slot objects per hour
  // Each: {position, minute, duration, category, type, notes}
  clockPattern    String?  // JSON string (SQLite doesn't support Json natively here)

  // Transition overrides (override station defaults)
  transitionCrossfadeDuration Float?
  transitionCurve             String?

  // Status
  isActive        Boolean  @default(true)

  // Relations
  assignments     ClockAssignment[]

  metadata        Json?

  @@index([stationId])
  @@index([clockType])
}

// Maps DJs to clock templates for specific time slots
model ClockAssignment {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // DJ
  djId            String
  dj              DJ       @relation(fields: [djId], references: [id], onDelete: Cascade)

  // Clock template
  clockTemplateId String
  clockTemplate   ClockTemplate @relation(fields: [clockTemplateId], references: [id], onDelete: Cascade)

  // Schedule
  dayType         String   @default("all") // weekday/saturday/sunday/all
  timeSlotStart   String   // "06:00"
  timeSlotEnd     String   // "09:00"

  // Priority
  priority        Int      @default(0)
  isActive        Boolean  @default(true)

  metadata        Json?

  @@unique([djId, dayType, timeSlotStart])
  @@index([stationId])
  @@index([djId])
  @@index([clockTemplateId])
}

// Station imaging voices for promos, IDs, sweepers
model StationImagingVoice {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // Voice info
  displayName     String   // "Station Voice - Male"
  voiceType       String   @default("male") // male/female

  // ElevenLabs config
  elevenlabsVoiceId String?
  voiceStability  Float    @default(0.75)
  voiceSimilarityBoost Float @default(0.75)
  voiceStyle      Float    @default(0.5)

  // Usage
  usageTypes      String   @default("id") // comma-separated: "promo,id,sweeper"
  isActive        Boolean  @default(true)

  metadata        Json?

  @@index([stationId])
}

// Show transitions (intros, outros, handoffs between DJs)
model ShowTransition {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // Transition config
  transitionType  String   // "show_intro", "show_outro", "handoff"
  name            String
  description     String?

  // Schedule context
  dayOfWeek       Int?     // 0-6
  hourOfDay       Int?     // 0-23
  timeContext      String?  // "morning_drive", "midday", etc.

  // Content
  scriptText      String?  // Script for AI voice generation
  audioFilePath   String?  // Pre-recorded audio URL
  durationSeconds Float    @default(15.0)

  // DJ references
  fromDjId        String?
  toDjId          String?

  // Handoff grouping
  handoffGroupId  String?
  handoffPart     Int?     // Order within group
  handoffPartName String?  // "Intro", "Response", "Farewell", "Launch"

  // Status
  isActive        Boolean  @default(true)
  priority        Int      @default(0)

  metadata        Json?

  @@index([stationId])
  @@index([transitionType])
  @@index([handoffGroupId])
}

// =============================================================================
// SHOW FEATURES - AI-generated radio show segments
// =============================================================================

// Feature type definitions (34 types: artist quickies, trivia, weather, etc.)
model FeatureType {
  id                    String   @id // slug like "artist_quickies"
  createdAt             DateTime @default(now())

  name                  String   // "Artist Quickies"
  description           String?
  category              String   // "all_shows" or "morning_only"
  trackPlacement        String?  // "before" | "after" | null

  // AI generation
  gptPromptTemplate     String?  // Template with {artist_name}, {song_title}, etc.
  suggestedDuration     Int      @default(30) // seconds

  // Engagement flags
  includesPoll          Boolean  @default(false)
  includesCallIn        Boolean  @default(false)
  socialMediaFriendly   Boolean  @default(false)

  // Sponsorship
  allowsSponsorship     Boolean  @default(true)

  isActive              Boolean  @default(true)

  // Relations
  content               FeatureContent[]
  schedules             FeatureSchedule[]

  @@index([category])
}

// Generated feature content cache
model FeatureContent {
  id                    String   @id @default(cuid())
  createdAt             DateTime @default(now())

  // Station
  stationId             String

  // Feature type
  featureTypeId         String
  featureType           FeatureType @relation(fields: [featureTypeId], references: [id], onDelete: Cascade)

  // Content
  title                 String?
  content               String   // The generated script/text
  contextData           String?  // JSON: artist_name, song_title, etc.

  // AI generation
  generatedBy           String?  // "gpt-4", "gpt-4-turbo"
  djPersonalityId       String?  // DJ it was generated for
  relatedSongId         String?  // Song linked to this feature (before/after)

  // Usage
  isUsed                Boolean  @default(false)
  playedAt              DateTime?
  playedByDj            String?

  // Audio
  audioFilePath         String?
  audioDuration         Int?     // seconds

  // Expiry
  expiresAt             DateTime?

  metadata              String?

  @@index([stationId])
  @@index([featureTypeId])
  @@index([isUsed, stationId])
  @@index([djPersonalityId])
}

// Feature schedule â€” what plays when for each DJ
model FeatureSchedule {
  id                    String   @id @default(cuid())
  createdAt             DateTime @default(now())

  // Station
  stationId             String

  // Feature type
  featureTypeId         String
  featureType           FeatureType @relation(fields: [featureTypeId], references: [id], onDelete: Cascade)

  // DJ
  djId                  String?
  djName                String   // Denormalized for display

  // Scheduling rules
  frequencyPerShow      Int      @default(1)
  minSongsBetween       Int      @default(3)
  priority              Int      @default(5)

  isActive              Boolean  @default(true)

  metadata              String?

  @@index([stationId])
  @@index([djId])
  @@index([featureTypeId])
}

// =============================================================================
// EMBED EVENTS & GAMIFICATION
// =============================================================================

// Embed event tracking (widget plays from external sites)
model EmbedEvent {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  sessionId         String?
  referralCode      String?
  referrerType      String?  // "scout", "artist", "sponsor", "listener"
  referrerId        String?
  listenerIp        String?  // hashed for privacy
  device            String   @default("embed")
  convertedToListener Boolean @default(false)
  listenerId        String?

  @@index([referralCode])
  @@index([referrerId])
  @@index([createdAt])
}

// XP transaction log for gamification
model XPTransaction {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  userId      String   // listenerId, artistId, or sponsorId
  userType    String   // "listener", "artist", "sponsor"
  action      String   // "listen_session", "streak_bonus", "referral", "embed_play", etc.
  xpAmount    Int
  metadata    String?  // JSON metadata

  @@index([userId, userType])
  @@index([action])
  @@index([createdAt])
}

// Badge definitions for gamification
model Badge {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  icon        String   // emoji or icon name
  category    String   // "listening", "social", "referral", "milestone", "embed", "artist", "sponsor"
  xpRequired  Int?     // auto-award at XP threshold
  condition   String   // machine-readable condition key

  @@index([category])
}

// System configuration (API keys, credentials, settings)
// Allows admin to configure services through the UI
model SystemConfig {
  key       String   @id
  value     String
  category  String   // "payments", "email", "sms", "ai", "auth", "discovery", "monitoring"
  label     String   // Human-readable label
  encrypted Boolean  @default(true) // Whether the value should be masked in UI
  updatedAt DateTime @updatedAt

  @@index([category])
}

// =============================================================================
// MUSIC BEDS & SPONSOR AD ROTATION
// =============================================================================

// Instrumental music bed files for ad/promo mixing
model MusicBed {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // File info
  name            String
  fileName        String
  filePath        String   // e.g. "/audio/music-beds/upbeat-01.mp3"
  durationSeconds Float?

  // Classification
  category        String   @default("general") // "upbeat", "soft", "corporate", "country", "general"

  // Status
  isActive        Boolean  @default(true)

  // Relations
  sponsorAds      SponsorAd[]

  metadata        Json?

  @@index([stationId])
  @@index([category])
  @@index([isActive])
}

// Sponsor ad records for even rotation scheduling
model SponsorAd {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Station
  stationId       String
  station         Station  @relation(fields: [stationId], references: [id], onDelete: Cascade)

  // Sponsor reference (optional FK)
  sponsorId       String?
  sponsorName     String

  // Ad content
  adTitle         String
  scriptText      String?
  musicBedId      String?
  musicBed        MusicBed? @relation(fields: [musicBedId], references: [id], onDelete: SetNull)

  // Audio
  audioFilePath   String?
  durationSeconds Float?

  // Tier & scheduling
  tier            String   @default("bronze") // "bronze", "silver", "gold", "platinum"
  weight          Int      @default(1)        // For weighted rotation

  // Status
  isActive        Boolean  @default(true)

  // Rotation tracking
  playCount       Int      @default(0)
  lastPlayedAt    DateTime?

  metadata        Json?

  @@index([stationId])
  @@index([isActive])
  @@index([lastPlayedAt])
  @@index([tier])
}
